---
const accessKey = import.meta.env.PUBLIC_WEB3FORMS_KEY ?? "";
const hasAccessKey = Boolean(accessKey);
---

{
  !hasAccessKey && (
    <div class="rounded-xl border border-dashed border-border/80 bg-background/50 p-4 text-sm text-muted">
      <p>
        Set <code>PUBLIC_WEB3FORMS_KEY</code> in your <code>.env</code> file to
        enable the contact form. Messages are powered by
        <a
          class="ml-1 underline decoration-dashed underline-offset-2 hover:text-accent"
          href="https://web3forms.com/"
          target="_blank"
          rel="noreferrer"
        >
          Web3Forms
        </a>
        .
      </p>
    </div>
  )
}

{
  hasAccessKey && (
    <form id="contact-form" class="space-y-4" method="POST">
      <input type="hidden" name="access_key" value={accessKey} />
      <label class="block text-sm font-semibold" for="contact-name">
        Name
        <input
          id="contact-name"
          name="name"
          type="text"
          required
          class="mt-1 w-full rounded-lg border border-border bg-background px-3 py-2 focus:border-accent focus:outline-none"
          placeholder="Your name"
        />
      </label>

      <label class="block text-sm font-semibold" for="contact-email">
        Email
        <input
          id="contact-email"
          name="email"
          type="email"
          required
          class="mt-1 w-full rounded-lg border border-border bg-background px-3 py-2 focus:border-accent focus:outline-none"
          placeholder="you@email.com"
        />
      </label>

      <label class="block text-sm font-semibold" for="contact-message">
        Message
        <textarea
          id="contact-message"
          name="message"
          rows="4"
          required
          class="mt-1 w-full rounded-lg border border-border bg-background px-3 py-2 focus:border-accent focus:outline-none"
          placeholder="How can I help?"
        />
      </label>

      <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
        <button
          type="submit"
          class="rounded-full bg-accent px-6 py-2 font-semibold text-white transition hover:-translate-y-0.5 hover:bg-accent/90 dark:text-slate-900"
        >
          Send message
        </button>
        <p id="contact-form-status" class="text-sm text-muted" />
      </div>
    </form>
  )
}

<script>
  const form = document.querySelector<HTMLFormElement>("#contact-form");
  const status = document.querySelector<HTMLElement>("#contact-form-status");

  if (form && status) {
    form.addEventListener("submit", async event => {
      event.preventDefault();
      const submitButton = form.querySelector<HTMLButtonElement>(
        "button[type=submit]"
      );
      const formData = new FormData(form);

      const setStatus = (message: string) => {
        status.textContent = message;
      };

      try {
        if (submitButton) submitButton.disabled = true;
        setStatus("Sending…");

        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          body: formData,
          headers: {
            Accept: "application/json",
          },
        });

        const data = await response.json();

        if (data.success) {
          setStatus("Thanks—I'll get back to you soon.");
          form.reset();
        } else {
          setStatus(data.message ?? "Unable to send your message.");
        }
      } catch {
        setStatus("Unable to send right now. Please email me directly.");
      } finally {
        if (submitButton) submitButton.disabled = false;
      }
    });
  }
</script>
