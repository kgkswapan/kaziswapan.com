---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import LinkButton from "@/components/LinkButton.astro";
import ProjectCard from "@/components/ProjectCard.astro";
import NoteCard from "@/components/NoteCard.astro";
import getSortedNotes from "@/utils/getSortedNotes";

const projects = await getCollection("projects");
const notes = await getCollection("notes");
const quotes = await getCollection("quotes");

const featuredProjects = projects
  .filter(project => project.data.featured)
  .sort((a, b) => a.data.title.localeCompare(b.data.title))
  .slice(0, 4);
const recentNotes = getSortedNotes(notes).slice(0, 4);
const randomQuote =
  quotes.length > 0
    ? quotes[Math.floor(Math.random() * quotes.length)]
    : null;
---

<Layout>
  <Header />
  <main id="main-content" class="mx-auto w-full max-w-app px-4 pb-12">
    <section class="section-unstyled pt-10 pb-8">
      <div class="flex flex-col items-center gap-6 text-center sm:flex-row sm:items-center sm:text-left">
        <img
          src="/assets/social-pro-pic.jpg"
          alt="Kazi Gulam Kadar"
          class="size-28 rounded-full object-cover shadow-lg sm:size-32"
          loading="lazy"
        />
        <div>
          <p class="text-sm uppercase tracking-[0.3em] text-accent">
            Kazi Gulam Kadar
          </p>
          <h1 class="mt-2 text-3xl font-semibold sm:text-4xl">
            Building, Supporting, and Improving Modern Trading Infrastructure.
          </h1>
          <p class="mt-3 text-base text-foreground/80">
            Bridging finance and engineering to deliver stable, efficient, and scalable trading workflows.
          </p>
          <div class="mt-6 flex flex-col gap-3 sm:flex-row">
            <LinkButton
              href="/projects"
              class="rounded-full border border-transparent bg-accent px-6 py-2 text-center font-semibold text-white transition hover:-translate-y-0.5 hover:bg-accent/90 dark:text-slate-900"
            >
              View Projects
            </LinkButton>
            <LinkButton
              href="/about"
              class="rounded-full border border-accent/60 px-6 py-2 text-center font-semibold text-accent transition hover:-translate-y-0.5 hover:border-accent sm:ms-3"
            >
              About Me
            </LinkButton>
          </div>
        </div>
      </div>
    </section>

    <section class="section-unstyled mt-12 px-0">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-baseline sm:justify-between">
        <h2 class="text-2xl font-semibold text-foreground">Featured Projects</h2>
        <LinkButton
          href="/projects"
          class="rounded-full border border-accent/60 px-4 py-2 text-sm font-semibold text-accent transition hover:-translate-y-0.5 hover:border-accent"
        >
          View all projects
        </LinkButton>
      </div>
      <div class="mt-6 grid gap-6 md:grid-cols-2">
        {featuredProjects.length > 0 ? (
          featuredProjects.map(project => <ProjectCard project={project} />)
        ) : (
          <p class="text-sm text-muted">No featured projects yet.</p>
        )}
      </div>
    </section>

    <section class="section-unstyled mt-12 px-0">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-baseline sm:justify-between">
        <h2 class="text-2xl font-semibold text-foreground">Recent Notes</h2>
        <LinkButton
          href="/notes"
          class="rounded-full border border-accent/60 px-4 py-2 text-sm font-semibold text-accent transition hover:-translate-y-0.5 hover:border-accent"
        >
          View all notes
        </LinkButton>
      </div>
      <div class="mt-6 grid gap-6 md:grid-cols-2">
        {recentNotes.length > 0 ? (
          recentNotes.map(note => <NoteCard note={note} />)
        ) : (
          <p class="text-sm text-muted">No notes published yet.</p>
        )}
      </div>
    </section>

    {randomQuote && (
      <section class="section-unstyled mt-12 px-0 text-center">
        <div class="rounded-2xl border border-border/70 bg-background/70 p-8 shadow-sm dark:bg-slate-900/40">
          <p class="text-7xl font-serif text-accent" aria-hidden="true">“</p>
          <p class="text-2xl italic text-foreground/90">{randomQuote.data.quote}</p>
          <p class="mt-4 text-base font-semibold text-foreground">{randomQuote.data.author}</p>
          {randomQuote.data.source && (
            <p class="text-sm text-muted">{randomQuote.data.source}</p>
          )}
          <p class="mt-4 text-7xl font-serif text-accent" aria-hidden="true">”</p>
        </div>
      </section>
    )}

    <section class="section-unstyled mt-12 px-0 text-center">
      <h2 class="text-3xl font-semibold text-foreground">
        Let’s build stable, efficient trading systems together.
      </h2>
      <div class="mt-6 flex flex-col gap-3 sm:flex-row sm:justify-center">
        <LinkButton
          href="/contact"
          class="rounded-full border border-transparent bg-accent px-6 py-2 font-semibold text-white transition hover:-translate-y-0.5 hover:bg-accent/90 dark:text-slate-900"
        >
          Get in touch
        </LinkButton>
        <LinkButton
          href="https://www.linkedin.com/in/kgkswapan/"
          target="_blank"
          class="rounded-full border border-accent/60 px-6 py-2 font-semibold text-accent transition hover:-translate-y-0.5 hover:border-accent"
        >
          Connect on LinkedIn
        </LinkButton>
      </div>
    </section>
  </main>
  <Footer />
</Layout>
